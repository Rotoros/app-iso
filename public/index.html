<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lista de Tareas</title>
<style>
body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 20px; background: #f4f4f9; }
h1 { color: #333; border-bottom: 2px solid #5cb85c; padding-bottom: 10px; }
#new-task-form { display: flex; gap: 10px; margin-bottom: 25px; }
#task-title { flex-grow: 1; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; }
button { cursor: pointer; padding: 10px 15px; border: none; border-radius: 4px; font-weight: bold; }
button[type="submit"] { background-color: #5cb85c; color: white; }
button[type="submit"]:hover { background-color: #4cae4c; }
.task-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid #ddd; background: white; margin-bottom: 5px; border-radius: 4px; }
.task-item.completed { background-color: #e9ecef; }
.task-item.completed span { text-decoration: line-through; color: #888; }
.actions button { margin-left: 8px; padding: 8px 12px; border-radius: 4px; }
.actions .toggle-btn { background-color: #007bff; color: white; }
.actions .toggle-btn.undo { background-color: #ffc107; color: #333; }
.actions .delete-btn { background-color: #dc3545; color: white; }
.actions button:hover { opacity: 0.9; }
</style>
</head>
<body>
<h1>ðŸ“‹ Lista de Tareas</h1>
<form id="new-task-form">
<input type="text" id="task-title" placeholder="Nueva tarea..." required>
<button type="submit">Agregar</button>
</form>
<div id="tasks-list"></div>

<script>
const tasksList = document.getElementById('tasks-list');
const newTaskForm = document.getElementById('new-task-form');
const taskTitleInput = document.getElementById('task-title');

async function loadTasks() {
  try {
    const res = await fetch('/api/tasks');
    const tasks = await res.json();
    tasksList.innerHTML = '';
    tasks.forEach(task => {
      const div = document.createElement('div');
      div.className = `task-item ${task.completed ? 'completed' : ''}`;
      div.dataset.id = task.id;
      const span = document.createElement('span');
      span.textContent = task.title;
      const actions = document.createElement('div');
      actions.className = 'actions';
      const toggleBtn = document.createElement('button');
      toggleBtn.className = `toggle-btn ${task.completed ? 'undo' : ''}`;
      toggleBtn.textContent = task.completed ? 'Desfacer' : 'Completar';
      toggleBtn.onclick = () => toggleTask(task.id, !task.completed);
      const deleteBtn = document.createElement('button');
      deleteBtn.className = 'delete-btn';
      deleteBtn.textContent = 'Eliminar';
      deleteBtn.onclick = () => deleteTask(task.id);
      actions.appendChild(toggleBtn);
      actions.appendChild(deleteBtn);
      div.appendChild(span);
      div.appendChild(actions);
      tasksList.appendChild(div);
    });
    if (tasks.length === 0) tasksList.innerHTML = '<p style="text-align:center;color:#666;">No hay tareas pendientes</p>';
  } catch(e) { console.error(e); tasksList.innerHTML = '<p style="color:red;">Error cargando tareas</p>'; }
}

newTaskForm.addEventListener('submit', async e => {
  e.preventDefault();
  const title = taskTitleInput.value.trim();
  if (!title) return;
  await fetch('/api/tasks', { method: 'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({title}) });
  taskTitleInput.value = '';
  loadTasks();
});

async function toggleTask(id, completed) {
  await fetch(`/api/tasks/${id}`, { method: 'PUT', headers:{'Content-Type':'application/json'}, body: JSON.stringify({completed}) });
  loadTasks();
}

async function deleteTask(id) {
  if(!confirm('Â¿Eliminar esta tarea?')) return;
  await fetch(`/api/tasks/${id}`, { method: 'DELETE' });
  loadTasks();
}

window.onload = loadTasks;
</script>
</body>
</html>
